version: '3.7'

services:

  swish-acquisition-build-dev:
    build:
      context: .
      target: dev
    image: swish-acquisition-dev:${IMAGE_TAG:-latest}

  swish-acquisition-build:
    build:
      context: .
      target: prod
    image: swish-acquisition:${IMAGE_TAG:-latest}

  swish-acquisition-run:
    image: swish-acquisition-dev:${IMAGE_TAG:-latest}
    depends_on:
      - swish-acquisition-rabbitmq
    volumes:
      - ./:/services/swish/swish-acquisition/
    command: celery -A swish_acquisition.celery_app:app worker -l info

  swish-acquisition-rabbitmq:
    hostname: rabbitmq
    image: rabbitmq:3.12.12-management-alpine
    ports:
      - "15672:15672"
      - "5672:5672"
    environment:
      RABBITMQ_DEFAULT_USER: rabbitmq
      RABBITMQ_DEFAULT_PASS: rabbitmq
      RABBITMQ_DEFAULT_VHOST: rabbitmq
